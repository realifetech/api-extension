services:
  RL\:
    resource: '../../src/*'
    autowire: true
    public: true
    exclude: '../../src/{Repository,Tests,Exception,Security}'

  RL\Repository\ApiKeyRepository:
    factory: 'Doctrine\ORM\EntityManagerInterface:getRepository'
    arguments:
      - RL\Entity\ApiKey

  RL\Repository\ApiKeyAccessRepository:
    factory: 'Doctrine\ORM\EntityManagerInterface:getRepository'
    arguments:
      - RL\Entity\ApiKeyAccess

  RL\Repository\AnalyticsRepository:
    class: RL\Repository\AnalyticsRepository
    arguments:
      - "@monolog.logger.api"

  RL\Security\Configurator\Configurator:
    class: RL\Security\Configurator\Configurator
    arguments:
      - "@doctrine.orm.entity_manager"
      - "@annotation_reader"
    tags:
      - { name: kernel.event_listener, event: kernel.request,  priority: 5 }

  RL\Security\Authenticator\ApiKeyAuthenticator:
    autowire: true

  RL\Serializers\IriResourcesNormalizer:
    autowire: true
    arguments:
      - '@api_platform.jsonld.normalizer.item'
    tags:
      - { 'name': 'serializer.normalizer', priority: 10}
